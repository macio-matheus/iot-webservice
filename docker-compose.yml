version: '3'

services:

  api:
    container_name: iot_api
    build:
      context: ./app
      dockerfile: Dockerfile
    command: tail -f /dev/null # python main.py
    working_dir: /app
    ports:
    - "5010:8080"
    depends_on:
      - mongo
    volumes:
    - ./app:/app

  notebook_data_science:
    container_name: iot_notebook
    image: maciomatheus/jupyter_notebook_data_science
    environment:
      JUPYTER_ENABLE_LAB: 1
      NB_UID: 10011
      GRANT_SUDO: "yes"
    user: root
    ports:
    - 8888:8888
    - 6007:6006
    volumes:
    - ./notebooks:/home/jovyan/work
    command: start-notebook.sh --NotebookApp.token=''

  mongo:
    container_name: db_mongo_iot
    image: mongo:3.4.2
    hostname: mongo_db_iot
    ports:
    - "27018:27017"
    command: mongod --smallfiles
    environment:
    - MONGO_INITDB_ROOT_USERNAME=root
    - MONGO_INITDB_ROOT_PASSWORD=root
    - MONGO_DB_NAME=db_iot